{
  "hash": "12e701dbf912fd6fbd8c36f86178aaad",
  "result": {
    "markdown": "---\ntitle: \"In-class Exercise 2\"\n#subtitle: \"Geospatial Data Wrangling with R\"\ndescription: \"R for Geospatital Data Science\"\nexecute: \n  warning: false\n  eval: true\n  echo: true\n  freeze: true\n# date: \"2024-02-19\"\ndate: 01/15/2024\ndate-format: \"D MMM, YYYY\" \nauthor: \n  - Wan Shen\nsidebar: false\ntitle-block-banner: true\ncategories:\n  - In-Class Exercise\ntitle-block-categories: false\n#format: \n#  html: \n#    code-fold: true\n#    code-summary: \"Show the code\"\n---\n\n\n# 1.0 Getting Started\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(sf, tmap, tidyverse, lubridate, arrow)\n```\n:::\n\n\n# 2.0 Importing Grab-Posisi Dataset\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- read_parquet(\"../../data/GrabPosisi/part-00000.parquet\")\ndf\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf$pingtimestamp <- as_datetime(df$pingtimestamp)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\norigin_df <- df %>% \n  group_by(trj_id) %>%\n  arrange(pingtimestamp) %>%\n  filter(row_number()==1) %>%\n  mutate(weekday = wday(pingtimestamp,\n                        label=TRUE,\n                        abbr=TRUE),\n         start_hr = factor(hour(pingtimestamp)),\n         day = factor(mday(pingtimestamp)))\norigin_df\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndestination_df <- df %>% \n  group_by(trj_id) %>%\n  arrange(desc(pingtimestamp)) %>%\n  filter(row_number()==1) %>%\n  mutate(weekday = wday(pingtimestamp,\n                        label=TRUE,\n                        abbr=TRUE),\n         end_hr = factor(hour(pingtimestamp)),\n         day = factor(mday(pingtimestamp)))\ndestination_df\n```\n:::\n\n::: {.cell}\n\n:::\n\n\n## 2.1 Import data\n\n\n::: {.cell}\n\n```{.r .cell-code}\norigin_df <- read_rds(\"../../data/rds/origin_df.rds\")\ndestination_df <- read_rds(\"../../data/rds/destination_df.rds\")\n```\n:::\n\n\n# 3.0 Converting aspatial data into geospatial data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlistings_sf <- st_as_sf(origin_df, \n                       coords = c(\"rawlng\", \"rawlat\"),\n                       crs=4326) %>%\n  st_transform(crs = 3414)\nglimpse(listings_sf)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 28,000\nColumns: 11\nGroups: trj_id [28,000]\n$ trj_id        <chr> \"70895\", \"21926\", \"47498\", \"41322\", \"18103\", \"64813\", \"8…\n$ driving_mode  <chr> \"car\", \"car\", \"car\", \"car\", \"car\", \"car\", \"car\", \"car\", …\n$ osname        <chr> \"android\", \"android\", \"ios\", \"android\", \"android\", \"ios\"…\n$ pingtimestamp <dttm> 2019-04-08 00:09:40, 2019-04-08 00:09:49, 2019-04-08 00…\n$ speed         <dbl> 6.799661, 10.812810, 18.307493, 18.670000, 14.072143, 19…\n$ bearing       <int> 41, 68, 307, 230, 155, 109, 213, 202, 179, 109, 312, 209…\n$ accuracy      <dbl> 4.000, 4.000, 8.000, 3.900, 4.000, 10.000, 10.000, 10.00…\n$ weekday       <ord> Mon, Mon, Mon, Mon, Mon, Mon, Mon, Mon, Mon, Mon, Mon, M…\n$ start_hr      <fct> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n$ day           <fct> 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,…\n$ geometry      <POINT [m]> POINT (21053.57 40263.52), POINT (31268.41 30410.2…\n```\n:::\n:::\n\n\n# 4.0 Visualising the data\n\n## 4.1 Visualising frequency distribution\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data=origin_df, \n       aes(x=weekday)) + \n  geom_bar()\n```\n\n::: {.cell-output-display}\n![](In-class_Ex02_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n## 4.2 Visualising as Point Symbol Map\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\ntm_shape(listings_sf) +\n  tm_dots()\n```\n\n::: {.cell-output-display}\n![](In-class_Ex02_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n# 5.0 Importing Master Plan 2019 Planning Subzone Boundary\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmpsz2019 <- st_read(\"../../data/geospatial/MasterPlan2019SubzoneBoundaryNoSeaKML.kml\") %>%\n  st_transform(crs = 3414)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `URA_MP19_SUBZONE_NO_SEA_PL' from data source \n  `C:\\wanshen123\\IS415-GAA\\data\\geospatial\\MasterPlan2019SubzoneBoundaryNoSeaKML.kml' \n  using driver `KML'\nSimple feature collection with 332 features and 2 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY, XYZ\nBounding box:  xmin: 103.6057 ymin: 1.158699 xmax: 104.0885 ymax: 1.470775\nz_range:       zmin: 0 zmax: 0\nGeodetic CRS:  WGS 84\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz2019) +\n  tm_polygons() +\ntm_shape(listings_sf) +\n  tm_dots()\n```\n\n::: {.cell-output-display}\n![](In-class_Ex02_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "In-class_Ex02_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}